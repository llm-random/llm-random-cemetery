parent: configs/baselines/gpt/expert_choice/granularity/4/medium.yaml
md5_parent_hash: 25eb0c53963eb1c7d96c91bb327c2a20
time: 0-10:00:00
interactive_debug_session: false
interactive_debug: false

params:
  name: "check_moe_grid_aux_loss"
  tags: []
  ff_mode: token_choice
  ^capacity_factor: [1.0, 1.25, 2]
  data_seed: 42

  activation_type: silu
  moe_inner_expert: ff_gated
  expansion_rate: 8
  granularity: 1
  get_router_values_from: weights
  layer_norm_in_expert_choice: False

  batch_size: 128
  cutoff: 128

  n_steps: 10_240
  final_lr_step: 10_240
  lr_warmup_steps: 102
  scheduler: cosine
  ^zloss_weight: [0.01, 0.001, 0.0001, 0]

  final_lr_fraction: 0.066666
  init_scale: 0.333
  learning_rate: 0.003
  weight_decay: 0.15
  ^load_balancing_loss_weight: [0.1, 0.01]

  save_weights_interval: 0
  mixed_precision: True
  loss_checkpoint_chungs: 4

  print_parameter_names: true
#  relative_lr:
#    embedding_layer: 3.333
#    head: 0.666
#    gating: 0.666
#    expert_inner_function: 0.3
#    projection: 1.
#
#  relative_scheduler_fraction:
#    embedding_layer: 0.666
#    head: 0.666
#    gating: 1.
#    expert_inner_function: 1.125
#    projection: 1.


tune_config:
  iters: 20
  tune_params:
    - "learning_rate"
    - "init_scale"
    - "final_lr_fraction"
    - "weight_decay"
    - "load_balancing_loss_weight"
#    - "relative_lr:embedding_layer"
#    - "relative_lr:head"
#    - "relative_lr:expert_inner_function"
#    - "relative_lr:gating"
#    - "relative_lr:projection"
#    - "relative_scheduler_fraction:embedding_layer"
#    - "relative_scheduler_fraction:head"
#    - "relative_scheduler_fraction:expert_inner_function"
#    - "relative_scheduler_fraction:gating"
#    - "relative_scheduler_fraction:projection"
